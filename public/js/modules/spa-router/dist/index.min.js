!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).ProfullstackSpaRouter={})}(this,(function(e){"use strict";const t=e=>{if(!e.includes(":"))return{regex:new RegExp(`^${e}$`),paramNames:[]};const t=(e.match(/:[^\s/]+/g)||[]).map((e=>e.slice(1))),o=e.replace(/:[^\s/]+/g,"([^/]+)").replace(/\//g,"\\/");return{regex:new RegExp(`^${o}$`),paramNames:t}},o=(e,t,o)=>{const n=e.match(t);if(!n)return null;const r={};return o.forEach(((e,t)=>{r[e]=n[t+1]})),r},n=e=>("/"!==(e=e||"/")&&e.endsWith("/")&&(e=e.slice(0,-1)),""===e&&(e="/"),e),r=e=>{const t=e.composedPath();for(let e=0;e<t.length;e++)if("A"===t[e].tagName)return t[e];return null},i=e=>{const t=e.getAttribute("href");return!!t&&(!t.startsWith("http")&&!t.startsWith("//")&&(!e.hasAttribute("target")&&(!e.hasAttribute("download")&&(!t.startsWith("#")&&!t.match(/\.\w+$/)))))};var s={pathToRegex:t,extractParams:o,normalizePath:n,findAnchorInPath:r,shouldHandleLink:i},a=Object.freeze({__proto__:null,default:s,extractParams:o,findAnchorInPath:r,normalizePath:n,pathToRegex:t,shouldHandleLink:i});const c=()=>async(e,t,o)=>(o.innerHTML=t,Promise.resolve()),l=(e={})=>{const t=e.duration||150,o=e.onComplete||(()=>{});return async(e,n,r)=>new Promise((e=>{const i=document.createElement("div");i.className="transition-overlay",i.style.position="fixed",i.style.top="0",i.style.left="0",i.style.width="100vw",i.style.height="100vh",i.style.backgroundColor="var(--background-color, #ffffff)",i.style.zIndex="9999",i.style.opacity="0",i.style.transition=`opacity ${t}ms ease-in-out`,document.body.appendChild(i),setTimeout((()=>{i.style.opacity="1"}),0),setTimeout((()=>{n instanceof DocumentFragment?(r.innerHTML="",r.appendChild(n.cloneNode(!0))):"string"==typeof n?r.innerHTML=n:(console.error("Unsupported content type:",typeof n),r.innerHTML=String(n)),i.style.opacity="0",setTimeout((()=>{document.body.contains(i)&&document.body.removeChild(i),o();document.querySelectorAll(".transition-overlay").forEach((e=>{document.body.contains(e)&&e!==i&&(console.log("Removing stale transition overlay"),document.body.removeChild(e))})),e()}),t)}),t),setTimeout((()=>{document.body.contains(i)&&(console.log("Safety timeout: removing transition overlay"),document.body.removeChild(i))}),3*t)}))},d=(e={})=>{const t=e.direction||"left",o=e.duration||300;return async(e,n,r)=>new Promise((i=>{const s=document.createElement("div");s.style.position="absolute",s.style.top="0",s.style.left="0",s.style.width="100%",s.style.height="100%",s.style.transition=`transform ${o}ms ease-in-out`,"string"==typeof e?s.innerHTML=e:(console.warn("Old content is not a string, using empty content"),s.innerHTML="");const a=document.createElement("div");a.style.position="absolute",a.style.top="0",a.style.left="0",a.style.width="100%",a.style.height="100%",a.style.transition=`transform ${o}ms ease-in-out`,n instanceof DocumentFragment?a.appendChild(n.cloneNode(!0)):"string"==typeof n?a.innerHTML=n:(console.error("Unsupported content type:",typeof n),a.innerHTML=String(n));let c="";switch(t){case"left":c="translateX(-100%)";break;case"right":c="translateX(100%)";break;case"up":c="translateY(-100%)";break;case"down":c="translateY(100%)"}r.innerHTML="",r.style.position="relative",r.style.overflow="hidden",r.appendChild(s),r.appendChild(a),a.getBoundingClientRect(),a.style.transform="translateX(0)",setTimeout((()=>{s.style.transform=c,setTimeout((()=>{r.innerHTML="",n instanceof DocumentFragment?r.appendChild(n.cloneNode(!0)):"string"==typeof n?r.innerHTML=n:(console.error("Unsupported content type:",typeof n),r.innerHTML=String(n)),r.style.position="",r.style.overflow="",i()}),o)}),10)}))},u=e=>async(t,o,n)=>e(t,o,n);var p={none:c,fade:l,slide:d,custom:u},h=Object.freeze({__proto__:null,custom:u,default:p,fade:l,none:c,slide:d});class m{constructor(e={}){this.routes={},this.rootElement=e.rootElement||"#app",this.errorHandler=e.errorHandler||this.defaultErrorHandler,this.transition=e.transition||l({duration:150}),this.currentRoute=null,this.loading=!1,this.middlewares=[],e.routes&&this.registerRoutes(e.routes),this.init()}init(){console.log("Router initializing..."),"complete"!==document.readyState&&"interactive"!==document.readyState||(console.log("Document already loaded, navigating to:",window.location.pathname),this.navigate(window.location.pathname,!1)),window.addEventListener("DOMContentLoaded",(()=>{console.log("DOMContentLoaded event, navigating to:",window.location.pathname),this.navigate(window.location.pathname,!1)})),window.addEventListener("popstate",(e=>{console.log("Popstate event, navigating to:",window.location.pathname),this.navigate(window.location.pathname,!1)})),document.addEventListener("click",(e=>{if(e.metaKey||e.ctrlKey||e.shiftKey)return;const t=r(e);if(!t)return;if(!i(t))return;const o=t.getAttribute("href");e.preventDefault(),this.navigate(o),console.log("Intercepted click on link:",o)}),{capture:!0})}registerRoutes(e){Object.entries(e).forEach((([e,t])=>{this.addRoute(e,t)}))}addRoute(e,o){const{regex:n,paramNames:r}=t(e);this.routes[e]={...o,regex:n,paramNames:r,path:e}}removeRoute(e){delete this.routes[e]}getCurrentRoute(){return this.currentRoute}back(){window.history.back()}forward(){window.history.forward()}use(e){this.middlewares.push(e)}async navigate(e,t=!0){console.log(`Router navigating to: ${e}`);const o=e;if(e=n(e),t&&(console.log("Updating history with path:",e),window.history.pushState({path:e},document.title,e)),this.loading)return void console.log("Already loading, skipping navigation");this.loading=!0;const r=this.findRoute(e);console.log("Found route:",r?"yes":"no");const i=document.querySelector(this.rootElement);if(!i)return console.error(`Root element "${this.rootElement}" not found`),void(this.loading=!1);try{const t=i.innerHTML;if(r){const o=this.currentRoute?this.currentRoute.path:null,n={path:e,params:r.params};let s=0;const a=async e=>{if(e)return this.loading=!1,this.navigate(e);if(s<this.middlewares.length){return(0,this.middlewares[s++])(n,o,a)}return this.renderRoute(r,i,t)};await a()}else{console.log("Route not found, showing 404 page for path:",o);try{const e=this.errorHandler(o,i);await this.transition(t,e,i)}catch(e){console.error("Error in error handler or transition:",e)}setTimeout((()=>{document.querySelectorAll(".transition-overlay").forEach((e=>{document.body.contains(e)&&document.body.removeChild(e)})),document.dispatchEvent(new CustomEvent("error-page-rendered",{detail:{path:e}}))}),100)}}catch(e){console.error("Error rendering route:",e),i.innerHTML=`<div class="error">Error loading page: ${e.message}</div>`}finally{this.loading=!1}}async renderRoute(e,t,o){let n;if(this.currentRoute=e,e.beforeEnter){const t=e=>!e||(this.loading=!1,this.navigate(e));if(!1===await e.beforeEnter(e,this.currentRoute,t))return void(this.loading=!1)}try{if("function"==typeof e.view)console.log("Calling view function with params:",e.params),n=await e.view(e.params);else if("string"==typeof e.view)console.log("Using string view"),n=e.view;else if(e.component){if(console.log("Creating component:",e.component),"string"==typeof e.component){const t=document.createElement(e.component);e.props&&Object.entries(e.props).forEach((([e,o])=>{t[e]=o})),n=t.outerHTML}else if("function"==typeof e.component){const t=await e.component(),o=new(t.default||t)(e.props);n=o.render?o.render():o.outerHTML}}else console.log("No view or component found, using empty content"),n="";if(await this.transition(o,n,t),e.afterRender){console.log("Calling afterRender function");try{e.afterRender(e.params)}catch(e){console.error("Error in afterRender:",e)}}window.dispatchEvent(new CustomEvent("route-changed",{detail:{path:e.path,route:e}}));const r=document.getElementById("initial-loading-overlay");r&&(r.style.opacity="0",setTimeout((()=>{r.parentNode&&r.parentNode.removeChild(r)}),150))}catch(e){throw console.error("Error rendering route content:",e),e}}findRoute(e){if(this.routes[e])return{...this.routes[e]};if("/"===e&&this.routes["/"])return{...this.routes["/"]};for(const t in this.routes){const n=this.routes[t];if(!t.includes(":"))continue;const r=o(e,n.regex,n.paramNames);if(r)return{...n,params:r}}return null}defaultErrorHandler(e){return`\n      <div class="error-page">\n        <h1>404 - Page Not Found</h1>\n        <p>The page "${e}" could not be found.</p>\n        <a href="/" class="back-link">Go back to home</a>\n      </div>\n    `}}function g(e){const t=Array.from(e.body.querySelectorAll('script[type="module"]')),o=Array.from(e.querySelectorAll('script[type="module"]')),n=[...new Set([...t,...o])].map((e=>e.getAttribute("src"))).filter((e=>e));return n.length>0&&console.log(`Found ${n.length} module scripts:`,n),n}async function f(e){return function(e){const t=e.querySelectorAll("script:not([src])");let o=t.length;return t.forEach((e=>{const t=document.createElement("script");[...e.attributes].forEach((e=>t.setAttribute(e.name,e.value))),t.textContent=e.textContent,e.replaceWith(t)})),o}}function y(e,t=!1){const o=document.createElement("div");return Array.from(e.children).forEach((e=>{(t||"SCRIPT"!==e.tagName)&&o.appendChild(e.cloneNode(!0))})),o}function w(e){const t=Array.from(e.querySelectorAll("script"));return t.length>0&&console.log(`Found ${t.length} script tags to clone`),t.map((e=>{const t=document.createElement("script");if(Array.from(e.attributes).forEach((e=>{t.setAttribute(e.name,e.value)})),t.textContent=e.textContent,t.src&&!t.src.startsWith("http://")&&!t.src.startsWith("https://")){const e=window.location.origin,o=t.src.startsWith("/")?`${e}${t.src}`:`${e}/${t.src}`;t.src=o}return t}))}function v(e){const t=document.createDocumentFragment();Array.from(e.body.children).forEach((e=>{"SCRIPT"!==e.tagName&&t.appendChild(e.cloneNode(!0))}));w(e).forEach((e=>{t.appendChild(e)}));const o=g(e);return o&&o.length>0&&(console.log(`Adding ${o.length} module scripts to the fragment`),o.forEach((e=>{const o=document.createElement("script");if(o.type="module",e.startsWith("http://")||e.startsWith("https://"))o.src=e;else{const t=window.location.origin,n=e.startsWith("/")?`${t}${e}`:`${t}/${e}`;o.src=n}console.log(`Adding module script: ${o.src}`),t.appendChild(o)}))),t}var E={extractModuleScriptSources:g,executeInlineScripts:f,filterScriptTags:y,extractAndCloneScripts:w,createFragmentWithScripts:v},b=Object.freeze({__proto__:null,createFragmentWithScripts:v,default:E,executeInlineScripts:f,extractAndCloneScripts:w,extractModuleScriptSources:g,filterScriptTags:y});function C(e={}){const t=e.translateContainer||(e=>{}),o=e.applyRTLToDocument||(()=>{}),n=!1!==e.handleScripts,r=!0===e.keepScripts;return async(e,i)=>{const s=document.createElement("div");let a,c;if(s.style.position="absolute",s.style.top="0",s.style.left="0",s.style.width="100%",s.style.height="100%",s.style.opacity="0",s.style.zIndex="1",e instanceof DocumentFragment){console.log("Received DocumentFragment as content"),a=document.implementation.createHTMLDocument("");const t=e.cloneNode(!0);a.body.appendChild(t)}else{if("string"!=typeof e)throw console.error("Unsupported content type:",typeof e),new Error("Unsupported content type: "+typeof e);{console.log("Received string as content");const t=new DOMParser;a=t.parseFromString(e,"text/html")}}let l=[],d=[];if(n)if(l=g(a),c=await f(),r)console.log("Collecting script tags to properly insert them later"),d=Array.from(a.querySelectorAll("script")).map((e=>{const t=document.createElement("script");return Array.from(e.attributes).forEach((e=>{t.setAttribute(e.name,e.value)})),t.textContent=e.textContent,e.parentNode&&e.parentNode.removeChild(e),t})),console.log(`Collected ${d.length} script elements`);else{const e=y(a.body,!1);for(;a.body.firstChild;)a.body.removeChild(a.body.firstChild);Array.from(e.children).forEach((e=>{a.body.appendChild(e)}))}const u={};i.querySelectorAll("*").filter((e=>e.tagName.includes("-"))).forEach((e=>{const t=e.tagName.toLowerCase();u[t]=e})),Array.from(a.body.children).forEach((e=>{e.tagName.includes("-")&&u[e.tagName.toLowerCase()]?console.log(`Preserving existing component: ${e.tagName.toLowerCase()}`):s.appendChild(e)})),t&&t(s),Object.values(u).forEach((e=>{s.appendChild(e)})),i.appendChild(s),o&&o(),setTimeout((()=>{if(Array.from(i.children).forEach((e=>{e!==s&&i.removeChild(e)})),s.style.position="relative",s.style.opacity="1",c&&(console.log("Executing inline scripts"),c(s)),d&&d.length>0&&(console.log(`Inserting ${d.length} script elements into the DOM`),d.forEach((e=>{if("module"===e.type?console.log(`Inserting module script: ${e.src||"inline"}`):console.log(`Inserting regular script: ${e.src||"inline"}`),e.src&&!e.src.startsWith("http://")&&!e.src.startsWith("https://")){const t=window.location.origin,o=e.src.startsWith("/")?`${t}${e.src}`:`${t}/${e.src}`;e.src=o}document.head.appendChild(e)}))),l.length>0){console.log("Importing module scripts after DOM update");const e=window.location.origin;l.forEach((t=>{const o=document.createElement("script");if(o.type="module",t.startsWith("http://")||t.startsWith("https://"))o.src=t;else{const n=t.startsWith("/")?`${e}${t}`:`${e}/${t}`;o.src=n}console.log(`Loading module script: ${o.src}`),document.head.appendChild(o)}))}window.dispatchEvent(new CustomEvent("spa-transition-end"))}),50)}}function R(e={}){return e=>`\n      <div class="error-page">\n        <h1>404 - Page Not Found</h1>\n        <p>The page "${e}" could not be found.</p>\n        <a href="/" class="back-link">Go back to home</a>\n      </div>\n    `}var $={createRenderer:C,createErrorHandler:R},T=Object.freeze({__proto__:null,createErrorHandler:R,createRenderer:C,default:$}),A={Router:m,transitions:h,utils:a,renderer:T,componentLoader:b};e.Router=m,e.componentLoader=b,e.default=A,e.renderer=T,e.transitions=h,e.utils=a,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=index.min.js.map
