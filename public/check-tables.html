<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Supabase Tables Check</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
      line-height: 1.6;
      color: #333;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    h1 {
      color: #F44B74;
      margin-bottom: 20px;
    }
    .container {
      background-color: #f9f9f9;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    .result-section {
      margin-bottom: 20px;
      border-bottom: 1px solid #eee;
      padding-bottom: 20px;
    }
    .result-section:last-child {
      border-bottom: none;
    }
    h2 {
      color: #333;
      font-size: 18px;
      margin-bottom: 10px;
    }
    pre {
      background-color: #f1f1f1;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
      font-family: monospace;
      font-size: 14px;
    }
    .error {
      color: #c62828;
      background-color: #ffebee;
      padding: 10px;
      border-radius: 4px;
      margin-bottom: 10px;
    }
    .success {
      color: #2e7d32;
      background-color: #e8f5e9;
      padding: 10px;
      border-radius: 4px;
      margin-bottom: 10px;
    }
    button {
      background-color: #F44B74;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 20px;
    }
    button:hover {
      background-color: #e03a63;
    }
    .loading {
      display: inline-block;
      margin-left: 10px;
      font-style: italic;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Supabase Tables Check</h1>
    <p>This tool checks the available tables in your Supabase database and displays their structure.</p>
    
    <button id="run-checks">Run Database Checks</button>
    <span id="loading" class="loading" style="display: none;">Running checks...</span>
    
    <div id="results" style="margin-top: 20px;">
      <div class="result-section">
        <h2>Available Tables</h2>
        <div id="tables-result">Click "Run Database Checks" to see results</div>
      </div>
      
      <div class="result-section">
        <h2>Users Table</h2>
        <div id="users-result">Click "Run Database Checks" to see results</div>
      </div>
      
      <div class="result-section">
        <h2>Table Columns</h2>
        <div id="columns-result">Click "Run Database Checks" to see results</div>
      </div>
    </div>
  </div>

  <script type="module">
    import { 
      checkAvailableTables, 
      checkUsersTable, 
      checkTableColumns 
    } from './js/check-tables.js';

    document.getElementById('run-checks').addEventListener('click', async () => {
      // Show loading indicator
      document.getElementById('loading').style.display = 'inline-block';
      
      // Clear previous results
      document.getElementById('tables-result').innerHTML = 'Loading...';
      document.getElementById('users-result').innerHTML = 'Loading...';
      document.getElementById('columns-result').innerHTML = 'Loading...';
      
      try {
        // Check available tables
        const tablesResult = await checkAvailableTables();
        if (tablesResult.success) {
          const tablesHtml = `
            <div class="success">Successfully retrieved tables</div>
            <pre>${JSON.stringify(tablesResult.tables, null, 2)}</pre>
          `;
          document.getElementById('tables-result').innerHTML = tablesHtml;
          
          // Check columns for each table
          let columnsHtml = '';
          if (tablesResult.tables && tablesResult.tables.length > 0) {
            for (const table of tablesResult.tables) {
              const tableName = table.table_name;
              const columnsResult = await checkTableColumns(tableName);
              
              if (columnsResult.success) {
                columnsHtml += `
                  <h3>Table: ${tableName}</h3>
                  <pre>${JSON.stringify(columnsResult.columns, null, 2)}</pre>
                `;
              } else {
                columnsHtml += `
                  <h3>Table: ${tableName}</h3>
                  <div class="error">Error: ${columnsResult.error.message || JSON.stringify(columnsResult.error)}</div>
                `;
              }
            }
          } else {
            columnsHtml = '<div class="error">No tables found to check columns</div>';
          }
          document.getElementById('columns-result').innerHTML = columnsHtml;
        } else {
          document.getElementById('tables-result').innerHTML = `
            <div class="error">Error: ${tablesResult.error.message || JSON.stringify(tablesResult.error)}</div>
          `;
          document.getElementById('columns-result').innerHTML = 'Could not check columns because table list failed';
        }
        
        // Check users table
        const usersResult = await checkUsersTable();
        if (usersResult.success) {
          const usersHtml = `
            <div class="success">Successfully accessed users data</div>
            <pre>${JSON.stringify(usersResult.users || usersResult.userStructure, null, 2)}</pre>
          `;
          document.getElementById('users-result').innerHTML = usersHtml;
        } else {
          document.getElementById('users-result').innerHTML = `
            <div class="error">Error: ${usersResult.error.message || JSON.stringify(usersResult.error)}</div>
          `;
        }
      } catch (err) {
        console.error('Error running checks:', err);
        document.getElementById('tables-result').innerHTML = `
          <div class="error">Error: ${err.message || JSON.stringify(err)}</div>
        `;
      } finally {
        // Hide loading indicator
        document.getElementById('loading').style.display = 'none';
      }
    });
  </script>
</body>
</html>