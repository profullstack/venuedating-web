<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title data-i18n="chat.page_title">Messages - BarCrush</title>
  <link rel="stylesheet" href="/css/theme.css">
  <script src="/js/dark-mode.js"></script>
  <script type="module" src="/js/auth-middleware.js"></script>
  <script type="module" src="/js/chat-controller.js"></script>
  <script type="module" src="/js/test-language-switch.js"></script>
  <script type="module">
    // Check authentication and redirect if not logged in
    import authMiddleware from '/js/auth-middleware.js';
    
    // Immediately check authentication before DOM is loaded
    (async function() {
      try {
        console.log('Checking authentication immediately...');
        
        // Check authentication using local storage first
        const userData = localStorage.getItem('barcrush_user');
        let isAuth = false;
        
        if (userData) {
          try {
            const user = JSON.parse(userData);
            if (user && user.id) {
              console.log('Valid user data found in local storage');
              isAuth = true;
            }
          } catch (e) {
            console.error('Error parsing user data:', e);
          }
        }
        
        // Skip auth middleware redirect - let page load normally
        console.log('Authentication check passed');
      } catch (error) {
        console.error('Authentication check failed:', error);
        window.location.href = '/auth';
        return;
      }
    })();
    
    document.addEventListener('DOMContentLoaded', async function() {
      // Initialize dark mode
      initDarkMode();
      
      // Skip double auth check - let page load normally
    });
  </script>
</head>
<body>
<div class="chat-page">
    <div class="chat-header">
        <div class="header-content" style="border: none; box-shadow: none;">
            <h1 class="page-title" data-i18n="chat.messages">Messages</h1>
        </div>
    </div>

    <!-- Search Bar -->
    <div class="search-container">
        <div class="search-bar">
            <svg class="search-icon" width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M11 19C15.4183 19 19 15.4183 19 11C19 6.58172 15.4183 3 11 3C6.58172 3 3 6.58172 3 11C3 15.4183 6.58172 19 11 19Z" stroke="#777" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M21 21L16.65 16.65" stroke="#777" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <input type="text" style="background-color: var(--input-background); border: none; color: var(--text-primary);" placeholder="Search" class="search-input">
        </div>
    </div>

    <!-- Messages List -->
    <div class="messages-section">
        <div class="messages-list">
            <!-- Messages will be populated dynamically by chat-controller.js -->
            <!-- Empty state will be shown if no conversations exist -->
        </div>
    </div>

    <!-- Bottom Navigation Component -->
    <bottom-navigation current-page="chat"></bottom-navigation>
    
    <!-- Conversation Modal -->
    <div class="conversation-modal" style="display: none;">
        <div class="conversation-container">
            <!-- Header with back button and contact info -->
            <div class="conversation-header">
                <div class="header-content">
                    <div class="back-button">
                        <button class="close-conversation">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M19 12H5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M12 19L5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    </div>
                    <div class="contact-info">
                        <div class="contact-avatar">
                            <img src="" alt="Contact">
                        </div>
                        <div class="contact-details">
                            <h2 class="contact-name">Contact</h2>
                            <p class="contact-status">Online</p>
                        </div>
                    </div>
                    <div class="header-actions">
                        <button class="action-button">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 13C12.5523 13 13 12.5523 13 12C13 11.4477 12.5523 11 12 11C11.4477 11 11 11.4477 11 12C11 12.5523 11.4477 13 12 13Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M19 13C19.5523 13 20 12.5523 20 12C20 11.4477 19.5523 11 19 11C18.4477 11 18 11.4477 18 12C18 12.5523 18.4477 13 19 13Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M5 13C5.55228 13 6 12.5523 6 12C6 11.4477 5.55228 11 5 11C4.44772 11 4 11.4477 4 12C4 12.5523 4.44772 13 5 13Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
            </a>

            <!-- Messages Container -->
            <div class="messages-container">
                <!-- Date Divider -->
                <div class="date-divider">
                    <span data-i18n="chat.today">Today</span>
                </div>

                <!-- Message from the other person -->
                <div class="message received">
                    <div class="message-content">
                        <p>Hey there! How are you doing? I saw you at the bar last night but didn't get a chance to say hello.</p>
                    </div>
                    <div class="message-time">09:15 AM</div>
                </div>

                <!-- Message from you -->
                <div class="message sent">
                    <div class="message-content">
                        <p>Hi! I'm doing great, thanks for asking. Yeah, I was there with some friends. Sorry I missed you!</p>
                    </div>
                    <div class="message-time">09:18 AM</div>
                </div>

                <!-- Message from the other person -->
                <div class="message received">
                    <div class="message-content">
                        <p>No worries at all! Maybe we can meet up sometime this week?</p>
                    </div>
                    <div class="message-time">09:20 AM</div>
                </div>

                <!-- Message from you -->
                <div class="message sent">
                    <div class="message-content">
                        <p>That sounds great! I'm free on Thursday evening. How about you?</p>
                    </div>
                    <div class="message-time">09:22 AM</div>
                </div>

                <!-- Message from the other person -->
                <div class="message received">
                    <div class="message-content">
                        <p>Thursday works for me! Same place?</p>
                    </div>
                    <div class="message-time">09:25 AM</div>
                </div>

                <!-- Message from the other person with image -->
                <div class="message received">
                    <div class="message-content with-image">
                        <img src="https://images.unsplash.com/photo-1514933651103-005eec06c04b?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1074&q=80" alt="Bar">
                        <p>Looking forward to it!</p>
                    </div>
                    <div class="message-time">09:26 AM</div>
                </div>

                <!-- Message from you -->
                <div class="message sent">
                    <div class="message-content">
                        <p>Perfect! I'll see you there at 8pm üçª</p>
                    </div>
                    <div class="message-time">09:30 AM</div>
                </div>
            </div>
            </a>

            <!-- Message Input Area -->
            <div class="message-input-area">
                <button class="attachment-button">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M21.44 11.05L12.25 20.24C11.1242 21.3658 9.59723 21.9983 8.005 21.9983C6.41277 21.9983 4.88584 21.3658 3.76 20.24C2.63416 19.1142 2.00166 17.5872 2.00166 15.995C2.00166 14.4028 2.63416 12.8758 3.76 11.75L12.33 3.18C13.0806 2.42943 14.0991 2.00153 15.165 2.00153C16.2309 2.00153 17.2494 2.42943 18 3.18C18.7506 3.93057 19.1785 4.94907 19.1785 6.015C19.1785 7.08093 18.7506 8.09943 18 8.85L9.41 17.44C9.03472 17.8153 8.52573 18.0242 8 18.0242C7.47427 18.0242 6.96528 17.8153 6.59 17.44C6.21472 17.0647 6.00583 16.5558 6.00583 16.03C6.00583 15.5042 6.21472 14.9953 6.59 14.62L14.07 7.14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
                <div class="message-input-wrapper">
                    <input type="text" class="message-input" placeholder="Type a message...">
                </div>
                <button class="send-button">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M22 2L11 13" stroke="#F44B74" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M22 2L15 22L11 13L2 9L22 2Z" stroke="#F44B74" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <script src="/components/bottom-nav.js" type="module"></script>

    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }
        
        body.modal-open {
            overflow: hidden;
        }
        
        body {
            background-color: var(--background-color);
            color: var(--text-primary);
            overflow-x: hidden;
        }
        
        .chat-page {
            min-height: 100vh;
            padding-bottom: 80px;
            background-color: var(--background-color);
        }

        /* Header Styles */
        .chat-header {
            padding: 16px 20px;
            background-color: var(--background-color);
            position: sticky;
            top: 0;
            z-index: 10;
            border-bottom: none
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .page-title {
            font-size: 26px;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
        }

        /* Search Bar */
        .search-container {
            padding: 10px 16px 20px;
        }

        .search-bar {
            display: flex;
            align-items: center;
            background-color: var(--input-background);
            border-radius: 50px;
            padding: 10px 18px;
            position: relative;
            border: 1px solid var(--border-color);
            box-shadow: 0 2px 8px var(--shadow-color);
            transition: all 0.2s ease;
        }
        
        .search-bar:focus-within {
            border-color: var(--primary-color);
            box-shadow: 0 3px 12px var(--primary-shadow);
        }

        .search-icon {
            margin-right: 12px;
            min-width: 24px;
        }
        
        .search-icon path {
            transition: stroke 0.2s ease;
        }
        
        .search-bar:focus-within .search-icon path {
            stroke: var(--primary-color);
        }

        .search-input {
            border: none;
            background: transparent;
            font-size: 16px;
            width: 100%;
            padding: 8px 0;
            outline: none;
            color: var(--text-primary);
            font-weight: 400;
        }
        
        .search-input::placeholder {
            color: var(--text-disabled);
            font-weight: 400;
        }

        /* Recent Contacts Section */
        .recent-section {
            padding: 0 16px 20px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text-primary);
        }

        .recent-contacts {
            display: flex;
            overflow-x: auto;
            gap: 20px;
            padding-bottom: 10px;
            scrollbar-width: none;
        }

        .recent-contacts::-webkit-scrollbar {
            display: none;
        }

        .contact-story {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .story-avatar {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            overflow: hidden;
            border: 2px solid #F44B74;
            padding: 2px;
        }

        .story-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .story-name {
            font-size: 12px;
            color: #333;
            max-width: 70px;
            text-align: center;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* Messages Section */
        .messages-section {
            padding: 0 16px;
        }

        .messages-list {
            display: flex;
            flex-direction: column;
        }

        .message-item {
            display: flex;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
            position: relative;
            cursor: pointer;
        }

        .message-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            overflow: hidden;
            margin-right: 12px;
            border: 1px solid #F44B74;
        }

        .message-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .message-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            overflow: hidden;
        }

        .message-top {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
        }

        .contact-name {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .message-time {
            font-size: 14px;
            margin-bottom: 6px;
            color: var(--text-tertiary);
        }

        .message-preview {
            font-size: 14px;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }
        
        /* Unread badge for conversation list */
        .message-item .unread-badge {
            position: absolute;
            top: 12px;
            right: 0;
            background: #FF4B77;
            color: white;
            border-radius: 50%;
            min-width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            border: 2px solid var(--background-color);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .message-item .unread-badge.dot {
            min-width: 12px;
            width: 12px;
            height: 12px;
            font-size: 0;
        }

        .typing {
            color: #F44B74;
            font-style: italic;
        }

        .you-text {
            color: #888;
            font-weight: 500;
        }

        .unread-badge {
            background-color: #F44B74;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 500;
            position: absolute;
            right: 10px;
            top: 60%;
            transform: translateY(-50%);
        }

        /* Bottom Navigation Styles */
        .bottom-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: white;
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            border-radius: 40px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }
        
        .bottom-nav-style1 {
            width: 300px;
            padding: 10px 20px;
        }
        
        .nav-item {
            padding: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s ease;
            text-decoration: none;
        }
        
        .nav-item.active {
            transform: scale(1.1);
        }
        
        /* Conversation Modal Styles */
        .conversation-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: white;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .conversation-modal.visible {
            opacity: 1;
        }
        
        .conversation-container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .conversation-header {
            padding: 12px 16px;
            background-color: #fff;
            position: sticky;
            top: 0;
            z-index: 10;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .conversation-header .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .back-button {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-conversation {
            background: transparent;
            border: none;
            color: #333;
            cursor: pointer;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-conversation:hover {
            background-color: #f5f5f5;
        }
        
        .contact-info {
            flex-grow: 1;
            display: flex;
            align-items: center;
            padding: 0 10px;
        }
        
        .conversation-header .contact-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            overflow: hidden;
            margin-right: 10px;
            border: 1px solid #F44B74;
        }
        
        .conversation-header .contact-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .conversation-header .contact-name {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 2px;
        }
        
        .contact-status {
            font-size: 12px;
            color: #4CAF50;
        }
        
        .header-actions {
            display: flex;
        }
        
        .action-button {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: transparent;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        .action-button:hover {
            background-color: #f5f5f5;
        }
        
        /* Empty conversation state */
        .empty-conversation {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
            text-align: center;
            color: var(--text-secondary);
        }
        
        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.6;
        }
        
        .empty-conversation p {
            margin: 8px 0;
            font-size: 16px;
        }
        
        .empty-subtitle {
            font-size: 14px !important;
            opacity: 0.7;
        }
        
        /* Error state */
        .error-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
            text-align: center;
            color: var(--text-secondary);
        }
        
        .error-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }
        
        .error-state button {
            margin-top: 16px;
            padding: 8px 16px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .error-state button:hover {
            opacity: 0.9;
        }
        
        /* Message images */
        .message-image {
            max-width: 200px;
            max-height: 200px;
            border-radius: 12px;
            margin-bottom: 8px;
        }
        
        /* Location messages */
        .location-message {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .location-icon {
            font-size: 18px;
        }
        
        .location-name {
            font-size: 12px;
            opacity: 0.7;
            margin-top: 4px;
        }
        
        /* Messages Container */
        .messages-container {
            flex-grow: 1;
            overflow-y: auto;
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 16px;
            background-color: #fff;
        }
        
        /* Date Divider */
        .date-divider {
            text-align: center;
            margin: 16px 0;
            position: relative;
        }
        
        .date-divider span {
            background-color: #f0f0f0;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            color: #666;
        }
        
        /* Message Styles */
        .message {
            max-width: 80%;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        
        .messages-container .message-content {
            padding: 12px 16px;
            border-radius: 18px;
            position: relative;
        }
        
        .messages-container .message-content p {
            margin: 0;
            font-size: 15px;
            line-height: 1.4;
        }
        
        .messages-container .message-time {
            font-size: 11px;
            color: #888;
            margin-top: 4px;
            align-self: flex-end;
        }
        
        .message.received {
            align-self: flex-start;
        }
        
        .message.sent {
            align-self: flex-end;
        }
        
        .message.received .message-content {
            background-color: #f5f5f5;
            border-bottom-left-radius: 4px;
        }
        
        .message.sent .message-content {
            background-color: #FFE0E8;
            color: #333;
            border-bottom-right-radius: 4px;
        }
        
        /* Image in messages */
        .message-content.with-image img {
            width: 100%;
            max-width: 240px;
            border-radius: 12px;
            margin-bottom: 8px;
            object-fit: cover;
        }
        
        /* Typing indicator */
        .typing-indicator {
            display: flex;
            align-items: center;
            align-self: flex-start;
            background-color: #f5f5f5;
            border-radius: 18px;
            padding: 12px 16px;
            max-width: 80px;
            gap: 4px;
        }
        
        .typing-indicator .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #aaa;
            animation: typing 1.5s infinite ease-in-out;
        }
        
        .typing-indicator .dot:nth-child(1) {
            animation-delay: 0s;
        }
        
        .typing-indicator .dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-indicator .dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-5px);
            }
        }
        
        /* Message Input Area */
        .message-input-area {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 16px;
            background-color: #fff;
            border-top: 1px solid #f0f0f0;
        }
        
        .attachment-button, .send-button {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        .attachment-button {
            background-color: transparent;
            color: #666;
        }
        
        .send-button {
            background-color: #fff;
            color: #F44B74;
        }
        
        .message-input-wrapper {
            flex-grow: 1;
            background-color: #f5f5f5;
            border-radius: 20px;
            padding: 0 16px;
        }
        
        .message-input {
            width: 100%;
            height: 40px;
            border: none;
            background-color: transparent;
            outline: none;
            font-size: 15px;
        }
        
        /* Mobile Responsive Improvements */
        @media (max-width: 768px) {
            /* Chat page mobile optimizations */
            .chat-page {
                padding-bottom: 100px; /* More space for bottom nav */
            }
            
            /* Header mobile improvements */
            .chat-header {
                padding: 12px 16px;
                position: sticky;
                top: 0;
                z-index: 20;
                background-color: var(--background-color);
                border-bottom: 1px solid var(--border-color);
            }
            
            .page-title {
                font-size: 22px;
                font-weight: 600;
            }
            
            /* Search container mobile */
            .search-container {
                padding: 8px 16px 16px;
            }
            
            .search-input {
                font-size: 16px; /* Prevents zoom on iOS */
                padding: 12px 16px;
                border-radius: 12px;
            }
            
            /* Messages list mobile */
            .messages-list {
                padding: 0 16px;
            }
            
            /* Message items mobile touch targets */
            .message-item {
                padding: 16px 0; /* Larger touch targets */
                border-bottom: 1px solid var(--border-color);
            }
            
            .message-avatar {
                width: 50px;
                height: 50px;
                margin-right: 12px;
            }
            
            .contact-name {
                font-size: 16px;
                font-weight: 600;
            }
            
            .message-preview {
                font-size: 14px;
                line-height: 1.4;
                margin-top: 4px;
            }
            
            .message-time {
                font-size: 12px;
            }
            
            /* Unread badge mobile positioning */
            .message-item .unread-badge {
                top: 16px;
                right: 0;
                min-width: 18px;
                height: 18px;
                font-size: 11px;
            }
            
            /* Recent contacts mobile scroll */
            .recent-contacts {
                gap: 16px;
                padding-bottom: 8px;
            }
            
            .story-avatar {
                width: 60px;
                height: 60px;
            }
            
            .story-name {
                font-size: 11px;
                max-width: 60px;
            }
        }
        
        /* Conversation Modal Mobile Improvements */
        @media (max-width: 768px) {
            .conversation-modal {
                padding: 0;
                border-radius: 0;
                width: 100vw;
                height: 100vh;
                max-width: none;
                max-height: none;
            }
            
            .conversation-header {
                padding: 16px;
                border-bottom: 1px solid var(--border-color);
                background: var(--background-color);
                position: sticky;
                top: 0;
                z-index: 10;
            }
            
            .conversation-header h3 {
                font-size: 18px;
                margin: 0;
            }
            
            .close-conversation {
                width: 32px;
                height: 32px;
                font-size: 18px;
                background: #f5f5f5;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            /* Messages container mobile */
            .messages-container {
                padding: 12px 16px;
                flex: 1;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            /* Message bubbles mobile */
            .message {
                max-width: 85%;
                margin-bottom: 8px;
            }
            
            .messages-container .message-content {
                padding: 10px 14px;
                border-radius: 16px;
                font-size: 15px;
                line-height: 1.4;
            }
            
            .messages-container .message-time {
                font-size: 11px;
                margin-top: 4px;
            }
            
            /* Date divider mobile */
            .date-divider {
                margin: 12px 0;
            }
            
            .date-divider span {
                font-size: 11px;
                padding: 4px 10px;
            }
            
            /* Message input mobile */
            .message-input-container {
                padding: 12px 16px;
                background: var(--background-color);
                border-top: 1px solid var(--border-color);
                position: sticky;
                bottom: 0;
            }
            
            .message-input-wrapper {
                border-radius: 24px;
                background-color: #f8f8f8;
                padding: 0 16px;
                min-height: 44px;
                display: flex;
                align-items: center;
            }
            
            .message-input {
                font-size: 16px; /* Prevents zoom on iOS */
                height: 44px;
                padding: 0;
                line-height: 1.4;
            }
            
            .input-actions {
                gap: 8px;
            }
            
            .input-action {
                width: 36px;
                height: 36px;
                border-radius: 50%;
                font-size: 16px;
            }
            
            /* Empty state mobile */
            .empty-conversation {
                padding: 40px 20px;
                text-align: center;
            }
            
            .empty-icon {
                font-size: 40px;
                margin-bottom: 12px;
            }
            
            .empty-conversation p {
                font-size: 15px;
                margin: 6px 0;
            }
            
            .empty-subtitle {
                font-size: 13px !important;
            }
        }
        
        /* Small mobile devices */
        @media (max-width: 480px) {
            .chat-header {
                padding: 10px 12px;
            }
            
            .page-title {
                font-size: 20px;
            }
            
            .search-container {
                padding: 6px 12px 12px;
            }
            
            .messages-list {
                padding: 0 12px;
            }
            
            .message-item {
                padding: 14px 0;
            }
            
            .message-avatar {
                width: 45px;
                height: 45px;
                margin-right: 10px;
            }
            
            .contact-name {
                font-size: 15px;
            }
            
            .message-preview {
                font-size: 13px;
            }
            
            /* Conversation modal small mobile */
            .conversation-header {
                padding: 12px;
            }
            
            .conversation-header h3 {
                font-size: 16px;
            }
            
            .messages-container {
                padding: 8px 12px;
            }
            
            .message {
                max-width: 90%;
            }
            
            .messages-container .message-content {
                padding: 8px 12px;
                font-size: 14px;
            }
            
            .message-input-container {
                padding: 10px 12px;
            }
            
            .message-input-wrapper {
                padding: 0 12px;
                min-height: 40px;
            }
            
            .message-input {
                height: 40px;
                font-size: 15px;
            }
            
            .input-action {
                width: 32px;
                height: 32px;
                font-size: 14px;
            }
        }
        
        /* Touch improvements for all mobile */
        @media (hover: none) and (pointer: coarse) {
            /* Better touch targets */
            .message-item {
                min-height: 60px;
                cursor: pointer;
                -webkit-tap-highlight-color: rgba(244, 75, 116, 0.1);
            }
            
            .message-item:active {
                background-color: rgba(244, 75, 116, 0.05);
                transform: scale(0.98);
                transition: all 0.1s ease;
            }
            
            .input-action {
                -webkit-tap-highlight-color: rgba(244, 75, 116, 0.2);
            }
            
            .input-action:active {
                transform: scale(0.9);
                transition: transform 0.1s ease;
            }
            
            .close-conversation {
                -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
            }
            
            .close-conversation:active {
                transform: scale(0.9);
                background-color: #e0e0e0;
            }
            
            /* Smooth scrolling on mobile */
            .messages-container {
                -webkit-overflow-scrolling: touch;
                scroll-behavior: smooth;
            }
            
            .messages-list {
                -webkit-overflow-scrolling: touch;
                scroll-behavior: smooth;
            }
        }
        
        /* Error States and Loading States */
        .loading-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
            text-align: center;
            color: var(--text-secondary);
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #F44B74;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 16px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
            text-align: center;
            color: var(--text-secondary);
        }
        
        .error-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.8;
        }
        
        .error-state h3 {
            margin: 0 0 12px 0;
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .error-state p {
            margin: 0 0 24px 0;
            font-size: 14px;
            line-height: 1.5;
            max-width: 300px;
        }
        
        .retry-button, .cta-button {
            background: #F44B74;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .retry-button:hover, .cta-button:hover {
            background: #e03d65;
            transform: translateY(-1px);
        }
        
        .retry-button:active, .cta-button:active {
            transform: translateY(0);
        }
        
        .error-details {
            margin-top: 16px;
            text-align: left;
            max-width: 300px;
        }
        
        .error-details summary {
            cursor: pointer;
            font-size: 12px;
            color: var(--text-tertiary);
            margin-bottom: 8px;
        }
        
        .error-details p {
            font-size: 11px;
            font-family: monospace;
            background: #f5f5f5;
            padding: 8px;
            border-radius: 4px;
            margin: 0;
            word-break: break-word;
        }
        
        /* Enhanced Empty State */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 80px 20px;
            text-align: center;
            color: var(--text-secondary);
        }
        
        .empty-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.6;
        }
        
        .empty-state h3 {
            margin: 0 0 12px 0;
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .empty-state p {
            margin: 0 0 32px 0;
            font-size: 15px;
            line-height: 1.5;
            max-width: 280px;
        }
        
        /* Toast Notifications */
        .message-error-toast, .message-success-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            max-width: 400px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
            transform: translateX(100%);
            transition: transform 0.3s ease;
            border-left: 4px solid #F44B74;
        }
        
        .message-success-toast {
            border-left-color: #28a745;
        }
        
        .message-error-toast.show, .message-success-toast.show {
            transform: translateX(0);
        }
        
        .toast-content {
            display: flex;
            align-items: center;
            padding: 16px;
            gap: 12px;
        }
        
        .toast-icon {
            font-size: 18px;
            flex-shrink: 0;
        }
        
        .toast-message {
            flex: 1;
            font-size: 14px;
            line-height: 1.4;
            color: var(--text-primary);
        }
        
        .toast-close {
            background: none;
            border: none;
            font-size: 18px;
            color: var(--text-tertiary);
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: background-color 0.2s ease;
        }
        
        .toast-close:hover {
            background-color: #f5f5f5;
        }
        
        /* Mobile toast adjustments */
        @media (max-width: 768px) {
            .message-error-toast, .message-success-toast {
                top: 10px;
                right: 10px;
                left: 10px;
                max-width: none;
            }
            
            .toast-content {
                padding: 12px;
            }
            
            .toast-message {
                font-size: 13px;
            }
        }
    </style>
</div>